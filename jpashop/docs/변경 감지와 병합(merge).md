## ì˜ì†ì„± í…í‹°í‹°

- ì—”í‹°í‹°ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ê°€ ëœë‹¤
- JPAëŠ” íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìƒˆë¡œ ì €ì¥ë˜ê±°ë‚˜ ë³€ê²½ëœ ë‚´ìš©ì„ ê°ì§€í•˜ê³  DBì— ë°˜ì˜í•œë‹¤ (flush)
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‚´ë¶€ì— ì¡´ì¬í•˜ëŠ” 1ì°¨ ìºì‹œë¥¼ í†µí•´ find()ë¥¼ í•˜ê²Œ ë˜ë©´ 1ì°¨ ìºì‹œì—ì„œ ë¨¼ì € ì—”í‹°í‹°ë¥¼ ì°¾ê³ , ì—†ë‹¤ë©´ DBì—ì„œ ì¡°íšŒí•œ ë’¤ 1ì°¨ ìºì‹œì— ì €ì¥í•˜ê³  ë°˜í™˜í•œë‹¤

## ì¤€ì˜ì† ì—”í‹°í‹°

- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ë”ëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ì—”í‹°í‹°
- ì„ì˜ë¡œ ë§Œë“¤ì–´ë‚¸ ì—”í‹°í‹°ë„ ê¸°ì¡´ ì‹ë³„ìë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©´ ì¤€ì˜ì† ì—”í‹°í‹°ë¡œ ë³¼ ìˆ˜ ìˆë‹¤

### ì¤€ì˜ì† ì—”í‹°í‹°ë¥¼ ìˆ˜ì •í•˜ëŠ” 2ê°€ì§€ ë°©ë²•

- ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ ì‚¬ìš©
- ë³‘í•©( `merge`) ì‚¬ìš©

### ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ ì‚¬ìš©

```java
@Transactional
void update(Item itemParam) { //itemParam: íŒŒë¦¬ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ì¤€ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°
    Item findItem = em.find(Item.class, itemParam.getId()); //ê°™ì€ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•œë‹¤.
    findItem.setPrice(itemParam.getPrice()); //ë°ì´í„°ë¥¼ ìˆ˜ì •í•œë‹¤. }
```

1. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì—”í‹°í‹°ë¥¼ ë‹¤ì‹œ ì¡°íšŒ
2. íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì¡°íšŒí•œ ì—”í‹°í‹°ì˜ ë°ì´í„°ë¥¼ ë³€ê²½
3. íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— ë³€ê²½ ê°ì§€(Dirty Checking)ì´ ë™ì‘í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— UPDATE SQL ì‹¤í–‰

> ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ëŠ” ë³€ê²½ ê°ì§€(dirty checking) ê¸°ëŠ¥ì´ ë™ì‘í•´ì„œ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•  ë•Œ ìë™ìœ¼ë¡œ ìˆ˜ì •ë˜ë¯€ë¡œ ë³„ë„ì˜ ìˆ˜ì • ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  í•„ìš”ê°€ ì—†ë‹¤!

### ë³‘í•© ì‚¬ìš©

```java
@Transactional
void update(Item itemParam) { //itemParam: íŒŒë¦¬ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ì¤€ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°
     Item mergeItem = em.merge(itemParam);
 }

```

ë³‘í•©ì€ ì¤€ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ì˜ì† ìƒíƒœë¡œ ë³€ê²½í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥

1. merge() ì‹¤í–‰
2. ì¤€ì˜ì† ì—”í‹°í‹°ì˜ ì‹ë³„ì ê°’ìœ¼ë¡œ ì˜ì† ì—”í‹°í‹°ë¥¼ ì¡°íšŒ
3. ì˜ì† ì—”í‹°í‹°ì˜ ê°’ì„ ì¤€ì˜ì† ì—”í‹°í‹°ì˜ ê°’ìœ¼ë¡œ ëª¨ë‘ êµì²´ (ë³‘í•©)
4. íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ì´ ë™ì‘í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— UPDATE SQL ì‹¤í–‰

> ğŸ’¡ ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ì›í•˜ëŠ” ì†ì„±ë§Œ ì„ íƒí•´ì„œ ë³€ê²½í•  ìˆ˜ ìˆì§€ë§Œ, ë³‘í•©ì„ ì‚¬ìš©í•˜ë©´ ëª¨ë“  ì†ì„±ì´ ë³€ê²½ëœë‹¤. ë³‘í•©ì‹œ ê°’ì´ ì—†ìœ¼ë©´ `null` ë¡œ ì—…ë°ì´íŠ¸ í•  ìœ„í—˜ë„ ìˆë‹¤. (ë³‘í•©ì€ ëª¨ë“  í•„ë“œë¥¼ êµì²´í•œë‹¤.)

## ê°€ì¥ ì¢‹ì€ ë°©ë²•

> ì—”í‹°í‹°ë¥¼ ë³€ê²½í•  ë•ŒëŠ” í•­ìƒ ë³€ê²½ ê°ì§€ë¥¼ ì‚¬ìš©í•˜ì!

- ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì–´ì„¤í”„ê²Œ ì—”í‹°í‹°ë¥¼ ìƒì„±í•˜ì§€ ë§ì
- íŠ¸ëœì­ì…˜ì´ ìˆëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì— ì‹ë³„ì(id)ì™€ ë³€ê²½í•  ë°ì´í„°ë¥¼ ëª…í™•í•˜ê²Œ ì „ë‹¬í•˜ì (íŒŒë¼ë¯¸í„° or DTO)
- íŠ¸ëœì­ì…˜ì´ ìˆëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ê³ , ì—”í‹°í‹°ì˜ ë°ì´í„°ë¥¼ ì§ì ‘ ë³€ê²½í•˜ì!
  - ê·¸ëŸ¼ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— ë³€ê²½ ê°ì§€ê°€ ì‹¤í–‰ëœë‹¤
- ì˜ì†ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•´ì„œ ë°ì´í„°ë¥¼ ë³€ê²½í•´ì•¼ -> íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë  ë•Œ flush ê°€ ì¼ì–´ë‚˜ë©´ì„œ ë³€ê²½ ê°ì§€ì— ì˜í•´ ì—…ë°ì´íŠ¸

```java
/**
* ìƒí’ˆ ìˆ˜ì •, ê¶Œì¥ ì½”ë“œ */
 @PostMapping(value = "/items/{itemId}/edit")
 public String updateItem(@PathVariable Long itemId, @ModelAttribute("form") BookForm form) {
     itemService.updateItem(itemId, form.getName(), form.getPrice(), form.getStockQuantity());
     return "redirect:/items";
 }
```
```java
public class ItemService {
     private final ItemRepository itemRepository;
     
     /**
     * ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ìë™ ë³€ê²½ 
     */
     @Transactional
     public void updateItem(Long id, String name, int price, int stockQuantity) {
         Item item = itemRepository.findOne(id);
         item.setName(name);
         item.setPrice(price);
         item.setStockQuantity(stockQuantity);
     } 
}
```
